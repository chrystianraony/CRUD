<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Codtry" />
    <meta name="description" content="PIUAE - é um site de controle de ....." />
    <meta name="keywords" content="Usuários, Painel de Controle, Dashboard" />

    <link rel="stylesheet" href="/css/normalize.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.17/sweetalert2.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.17/sweetalert2.all.js"
      integrity="sha512-L0pIRrYrKsfCidtpWhWSrrbyAcSfrvMaezfwnNGns7c7MuToIEZRabX+WmZ6+Dzn8ESNsHz7t/k6vF8aM1fVXg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.4.17/sweetalert2.js"
      integrity="sha512-zL6Mk/gs8FtX6ZaN+ObOH/biB8Phx217vhCxRLzNdfHX2JlPgbmVuu948wqLYxY+QqgaLnbIbg6g5J7zszY4dg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      function excluirUsuario(event, id) {
        console.log(event);
        event.preventDefault();

        Swal.fire({
          title: "Deletar usuário?",
          showDenyButton: true,
          showCancelButton: false,
          confirmButtonText: "Excluir",
          denyButtonText: `Cancelar`,
        }).then((result) => {
          if (result.isConfirmed) {
            axios.delete(`http://localhost:8080/users/${id}`)
              .then((data) => {
                Swal.fire("Excluido!", "", "success").then((result) => {
                  window.location = "/users/users.html";
                });
              })
              .catch((error) => {
                console.log("Error:", error);
              });
          }
        });
      }
    </script>

    <title>PIUAE - Página Inicial</title>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="content">
          <div id="logo">
            <a href="index.html">
              <img src="/img/logo.png" alt="Logo PIUAE" />
            </a>
          </div>

          <nav>
            <ul>
              <li>
                <a href="/index.html">Home</a>
              </li>
              <li>
                <a href="/users/users.html">Usuários</a>
              </li>
              <li>
                <a href="/cargos">Cargos</a>
              <li>
              <li>
                <a href="/contact.html">Contato</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <main>
      <section id="usuarios">
        <div class="container">
          <h2>
            Lista de Usuários
            <a href="/users/new.html" class="btn btn-new">
              <span class="mdi mdi-account-multiple-plus"></span>
              Criar Usuário
            </a>
          </h2>
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>CPF</th>
                <th>RG</th>
                <th>E-mail</th>
                <th>Cidade</th>
                <th>Cargos</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="tabelaTeste">
              <script>
                let table = document.querySelector("tbody#tabelaTeste");
                
                axios.get("http://localhost:8080/users")
                  .then((response) => {
                    users = response.data
                      users.forEach((user) => {
                        let tr = document.createElement("tr"); 
                        tr.innerHTML =                //foi adicionado o cargo, mas tem que verificar se é necessário
                          `<td>${user.nome}</td>
                           <td>${user.cpf}</td>
                           <td>${user.rg}</td>
                           <td>${user.email}</td>                           
                           <td>${user.cidade}</td>
                           <td>${user.cargo_id}</td>       
                           <td class="acoes">
                              <a href="visualizar.html?id=${user.id}" id="visualizar" class="btn btn-show">
                                <span class="mdi mdi-eye"></span>
                              </a>
                              <a href="edit.html?id=${user.id}" id="editar" class="btn btn-edit">
                                <span class="mdi mdi-lead-pencil"></span>
                              </a>
                              <button class="btn btn-delete" type="button" onclick="excluirUsuario(event, ${user.id})">
                                <span class="mdi mdi-trash-can-outline"></span>
                              </button>
                          
                            </td>`;

                      table.appendChild(tr);
                      });
                    });
              </script>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <p>Todos os direitos reservados &copy; 2022</p>
      </div>
    </footer>
  </body>
</html>
